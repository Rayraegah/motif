Motif.Page.include("Motif.Ui.Controls.Control.js"),Motif.Page.include("Motif.Ui.Css.js"),Motif.Page.include("Motif.Ui.Utility.js"),Motif.Page.include("Motif.Ui.Controls.WindowManager.js"),Motif.Page.include("Motif.Ui.Devices.Mouse.js"),Motif.Page.include("Motif.Collections.List.js"),Motif.Page.include("Motif.Dom.Utility.js"),Motif.Ui.Controls.Window=function(t){Motif.Utility.extend(this,"Motif.Ui.Controls.Control"),this.__class.push("Motif.Ui.Controls.Window"),this._trs={top:null,center:null,bottom:null},this._tds={nw:null,n:null,ne:null,w:null,body:null,e:null,sw:null,s:null,se:null},this._handlers={nw:null,n:null,ne:null,w:null,body:null,e:null,sw:null,s:null,se:null,mouseButtonChange:null,mousePositionChange:null},this._action="",this._borderSize=7,this._rectTracking=null,this.innerWidth=0,this.innerHeight=0,this.actions=new Motif.Collections.List(["","nw-resize","n-resize","ne-resize","w-resize","move","e-resize","sw-resize","s-resize","se-resize"]),this._bodyWindow=null,this.getBody=function(){return this._bodyWindow},this._createElement=function(){Motif.Page.log.write("Motif.Ui.Controls.Window._createElement: Creating a new table element.");var t=document.createElement("table"),e={},i={};t.cellSpacing=0,t.cellPadding=0,t.style.cssText="table-layout:fixed;";var n=t.appendChild(document.createElement("tbody"));return e.top=n.appendChild(document.createElement("tr")),e.center=n.appendChild(document.createElement("tr")),e.bottom=n.appendChild(document.createElement("tr")),i.nw=e.top.appendChild(document.createElement("td")),i.n=e.top.appendChild(document.createElement("td")),i.ne=e.top.appendChild(document.createElement("td")),i.w=e.center.appendChild(document.createElement("td")),i.body=e.center.appendChild(document.createElement("td")),i.e=e.center.appendChild(document.createElement("td")),i.sw=e.bottom.appendChild(document.createElement("td")),i.s=e.bottom.appendChild(document.createElement("td")),i.se=e.bottom.appendChild(document.createElement("td")),i.body.className="body",t},this.center=function(){var t=Motif.Ui.Utility.getRectangle(this.element),e=Motif.Ui.Devices.Screen.getVisibleRectangle();Motif.Page.log.write("Motif.Ui.Controls.Window.center: Moving the window ("+t+") to the center of the visible screen ("+e+")"),t.setCenter(e.getCenter()),Motif.Page.log.write("Motif.Ui.Controls.Window.center: Moving the window ("+t+")"),this.setLeft(t.x),this.setTop(t.y)},this.enableResizing=function(){Motif.Page.log.write("Motif.Ui.Controls.Window.enableResize: Adding event handlers to the resize boxes.");for(e in this._tds)if("body"!=e){var t=e+"-resize";this._handlers[e]||(this._handlers[e]=new Function(this.referenceString()+".setAction('"+t+"')")),this._tds[e].style.cursor=t,Motif.Utility.attachEvent(this._tds[e],"onmousedown",this._handlers[e])}},this.disableResizing=function(){Motif.Page.log.write("Motif.Ui.Controls.Window.disableResize: Removing event handlers from resize boxes, if any.");for(e in this._tds)"body"!=e&&(this._tds[e].style.cursor="default",Motif.Type.isFunction(this._handlers[e])&&Motif.Utility.detachEvent(this._tds[e],"onmousedown",this._handlers[e]))},this.enableMoving=function(){Motif.Page.log.write("Motif.Ui.Controls.Window.enableMove: Adding event handler to body for mousemove.");var t="move";Motif.Type.isFunction(this._handlers.body)||(this._handlers.body=new Function(this.referenceString()+".setAction('"+t+"')")),this._bodyWindow.style.cursor=t,Motif.Utility.attachEvent(this._bodyWindow,"onmousedown",this._handlers.body)},this.disableMoving=function(){Motif.Page.log.write("Motif.Ui.Controls.Window.disableMove: Removing event handler from body box."),Motif.Type.isFunction(this._handlers.body)&&(this._tds.body.style.cursor="default",Motif.Utility.detachEvent(this._tds.body,"onmousedown",this._handlers.body))},this.enableScrolling=function(){this._bodyWindow.style.overflow="auto"},this.disableScrolling=function(){this._bodyWindow.style.overflow="hidden"},this.setAction=function(t){-1!=this.actions.indexOf(t)&&this._action!=t&&(this.fireEvent("onbeforeactionchange",[this._action,t]),-1!=this._action.indexOf("resize")&&this.fireEvent("onresizeend"),"move"==this._action&&this.fireEvent("onmoveend"),-1!=t.indexOf("resize")&&this.fireEvent("onresizestart"),"move"==t&&this.fireEvent("onmovestart"),Motif.Page.log.write("Motif.Ui.Controls.Window.setAction: Action changed from '"+this._action+"' to '"+t+"'"),this._action=t,this.fireEvent("onactionchange",[t]))},this.getAction=function(){return this._action},this.activate=function(){Motif.Ui.Controls.WindowManager.activeWindow!==this&&(this.fireEvent("onbeforeactivate"),Motif.Ui.Controls.WindowManager.activate(this),this.fireEvent("onactivate"))},this._deactivate=function(){this.fireEvent("ondeactivate")},this.setBorderSize=function(t){Motif.Type.isNumber(t)&&(this._borderSize=t),Motif.Page.log.write("Motif.Ui.Controls.Window.setBorderSize: Setting the border size to: "+this._borderSize.toString()+" pixels.");for(e in this._tds)(-1!=e.indexOf("n")||-1!=e.indexOf("s"))&&(this._tds[e].style.height=this._borderSize.toString()+"px"),(-1!=e.indexOf("e")||-1!=e.indexOf("w"))&&(this._tds[e].style.width=this._borderSize.toString()+"px")},this.getBorderSize=function(){return this._tds.e&&this._tds.e.style.width?parseInt(this._tds.e.style.width):0},this._getTableRows=function(t){var e=t.getElementsByTagName("tbody")[0];return null==e?[]:Motif.Dom.Utility.getChildElements(e,"tr")},this._getTableCells=function(t){for(var e=[],i=this._getTableRows(t),n=0;n<i.length;n++)e=e.concat(Motif.Dom.Utility.getChildElements(i[n],"td"));return e},this._isWindowElement=function(t){var e=this._getTableRows(t),i=this._getTableCells(t);return 3==e.length&&9==i.length},this.configure=function(t){return t=this.Motif$Ui$Controls$Control.configure(t),Motif.Page.log.write("Motif.Ui.Controls.Window.configure: Setting the window specific items from config."),Motif.Type.isNumber(t.border)&&this.setBorderSize(t.border),Motif.Type.isBoolean(t.center)&&(t.center?this.center():this.center()),Motif.Type.isBoolean(t.resizable)&&(t.resizable?this.enableResizing():this.disableResizing()),Motif.Type.isBoolean(t.movable)&&(t.movable?this.enableMoving():this.disableMoving()),Motif.Type.isBoolean(t.scrolling)&&(t.scrolling?this.enableScrolling():this.disableScrolling()),this._initDimension(),t},this.setElement=function(t){if(Motif.Page.log.write("Motif.Ui.Controls.Window.setElement: Binding the element to this window object."),!this._isWindowElement(t)){Motif.Page.log.write("Motif.Ui.Controls.Window.setElement: Invalid element supplied, replacing it.");var i=this._createElement();Motif.Ui.Utility.copyAttributes(t,i),Motif.Ui.Css.addClassName(i,this.getCssClassName());for(var n=this._getTableCells(i)[4],o=0;o<t.childNodes.length;o++)n.appendChild(t.childNodes[o].cloneNode(!0));null!=t.parentNode&&t.parentNode.replaceChild(i,t),t=i}this.Motif$Ui$Controls$Control.setElement(t);var s=0,r=this._getTableRows(this.element),h=this._getTableCells(this.element);for(e in this._trs)this._trs[e]=r[s],s++;s=0;for(e in this._tds)this._tds[e]=h[s],s++;return this._bodyWindow=this._tds.body,this.element.style.position="absolute",this._bodyWindow.className="Motif-Ui-Controls-Window-Body",this._bodyWindow.style.cssText="overflow:hidden; padding:0px; margin:0px; vertical-align:top",this._bodyWindow.ondragstart=this._bodyWindow.onselectstart=this._bodyWindow.ondraggesture=function(){return!1},this.setBorderSize(),this.enableResizing(),this.enableMoving(),this._initDimension(),Motif.Utility.attachEvent(this.element,"onmousedown",new Function(this.referenceString()+".activate()")),t},this._initDimension=function(){var t=this.getWidth(),e=this.getHeight();this._beforeResizeWindow(t<this.minWidth?this.minWidth:t,e<this.minHeight?this.minHeight:e)},this._beforeResizeWindow=function(t,i){if(!this._margin){this._margin={left:0,top:0,right:0,bottom:0};for(e in this._margin){var n=parseInt(Motif.Ui.Css.getCurrentStyle(this._bodyWindow,"padding-"+e)),o=parseInt(Motif.Ui.Css.getCurrentStyle(this._bodyWindow,"border-"+e+"-width"));isNaN(o)||(this._margin[e]+=o),isNaN(n)||(this._margin[e]+=n),this._margin[e]+=this.getBorderSize()}}Motif.Type.isUndefined(t)||(this.innerWidth=t-(this._margin.left+this._margin.right),this.innerWidth>0&&(this._bodyWindow.style.width=this.innerWidth.toString()+"px")),Motif.Type.isUndefined(i)||(this.innerHeight=i-2*this.getBorderSize(),this.innerHeight>0&&(this._bodyWindow.style.height=this.innerHeight.toString()+"px"))},this._activateWindow=function(){Motif.Page.log.write("Motif.Ui.Controls.Window._activateWindow: Window activated, mouse events attached."),Motif.Ui.Devices.Mouse.attachEvent("onpositionchange",this._handlers.mousePositionChange),Motif.Ui.Devices.Mouse.attachEvent("onbuttonchange",this._handlers.mouseButtonChange)},this._deactivateWindow=function(){Motif.Ui.Devices.Mouse.detachEvent("onpositionchange",this._handlers.mousePositionChange),Motif.Ui.Devices.Mouse.detachEvent("onbuttonchange",this._handlers.mouseButtonChange)},this._mouseButtonChangeWindow=function(){return Motif.Ui.Devices.Mouse.button==Motif.Ui.Devices.MouseButtons.None?void this.setAction(""):void(this._rectTracking=Motif.Ui.Utility.getRectangle(this.element))},this._mousePositionChangeWindow=function(t,e){if(""!=this._action&&("move"==this._action&&(this._rectTracking.moveBy(t,e),this.move(this._rectTracking.x,this._rectTracking.y)),-1!=this._action.indexOf("resize"))){var i=this._action.split("-").shift();-1!=i.indexOf("w")&&(this._rectTracking.resizeBy(-1*t,0),this._rectTracking.moveBy(t,0)),-1!=i.indexOf("n")&&(this._rectTracking.resizeBy(0,-1*e),this._rectTracking.moveBy(0,e)),-1!=i.indexOf("e")&&this._rectTracking.resizeBy(t,0),-1!=i.indexOf("s")&&this._rectTracking.resizeBy(0,e),(-1!=i.indexOf("n")||-1!=this._action.indexOf("w"))&&this.move(this._rectTracking.x,this._rectTracking.y),this.resize(this._rectTracking.w,this._rectTracking.h)}},this.onmovestart=function(){},this.onmoveend=function(){},this.onresizestart=function(){},this.onresizeend=function(){},this.main=function(t){t||(t={resizable:!0,movable:!0,width:400,height:200}),t.element||(t.element=this._createElement()),this.attachEvent("onbeforeresize",this._beforeResizeWindow),this.attachEvent("onactivate",this._activateWindow),this.attachEvent("ondeactivate",this._deactivateWindow),this._handlers.mouseButtonChange=new Function(this.referenceString()+"._mouseButtonChangeWindow();"),this._handlers.mousePositionChange=new Function("diffX","diffY",this.referenceString()+"._mousePositionChangeWindow(diffX, diffY);"),this.minWidth=27,this.minHeight=27,this.configure(t),this._rectTracking=Motif.Ui.Utility.getRectangle(this.element)},this.main(t)};