Motif.Ui.Devices.Keyboard={lastKey:-1,key:-1,shiftKey:!1,altKey:!1,ctrlKey:!1,trackers:{},trackerCount:0,register:function(e){0==Motif.Ui.Devices.Keyboard.trackerCount&&Motif.Ui.Devices.Keyboard._attachEvents();var t="tracker"+e.ptr.toString();t in Motif.Ui.Devices.Keyboard.trackers||(Motif.Ui.Devices.Keyboard.trackers[t]=e,Motif.Ui.Devices.Keyboard.trackerCount++)},unregister:function(e){var t="tracker"+e.ptr.toString();t in Motif.Ui.Devices.Keyboard.trackers&&(delete Motif.Ui.Devices.Keyboard.trackers[t],Motif.Ui.Devices.Keyboard.trackerCount--,0==Motif.Ui.Devices.Keyboard.trackerCount&&Motif.Ui.Devices.Keyboard._detachEvents())},_attachEvents:function(){Motif.Page.log.write("Motif.Ui.Devices.Keyboard._attachEvents: Attaching events."),Motif.Utility.attachEvent(document,"onkeydown",Motif.Ui.Devices.Mouse._keyDown),Motif.Utility.attachEvent(document,"onkeyup",Motif.Ui.Devices.Mouse._keyUp)},_detachEvents:function(){Motif.Page.log.write("Motif.Ui.Devices.Keyboard._detachEvents: Detaching events."),Motif.Utility.detachEvent(document,"onkeydown",Motif.Ui.Devices.Mouse._keyDown),Motif.Utility.detachEvent(document,"onkeyup",Motif.Ui.Devices.Mouse._keyUp)},_keyDown:function(e){e=e||event,Motif.Ui.Devices.Keyboard.key=e.keyCode,Motif.Ui.Devices.Keyboard.shiftKey=e.shiftKey,Motif.Ui.Devices.Keyboard.ctrlKey=e.ctrlKey,Motif.Ui.Devices.Keyboard.altKey=e.altKey;for(e in Motif.Ui.Devices.Mouse.trackers)Motif.Ui.Devices.Mouse.trackers[e].setKeys(Motif.Ui.Devices.Keyboard.key,Motif.Ui.Devices.Keyboard.shiftKey,Motif.Ui.Devices.Keyboard.ctrlKey,Motif.Ui.Devices.Keyboard.altKey)},_keyUp:function(e){e=e||event,Motif.Ui.Devices.Keyboard.lastKey=Motif.Ui.Devices.Keyboard.key,Motif.Ui.Devices.Keyboard.key=-1,Motif.Ui.Devices.Keyboard.shiftKey=e.shiftKey,Motif.Ui.Devices.Keyboard.ctrlKey=e.ctrlKey,Motif.Ui.Devices.Keyboard.altKey=e.altKey;for(e in Motif.Ui.Devices.Mouse.trackers)Motif.Ui.Devices.Mouse.trackers[e].setKeys(Motif.Ui.Devices.Keyboard.key,Motif.Ui.Devices.Keyboard.shiftKey,Motif.Ui.Devices.Keyboard.ctrlKey,Motif.Ui.Devices.Keyboard.altKey)}},Motif.Ui.Devices.KeyboardTracker=function(e){Motif.Utility.extend(this,"Motif.Object"),this.__class.push("Motif.Ui.Devices.KeyboardTracker"),this.lastKey=-1,this.key=-1,this.shiftKey=!1,this.altKey=!1,this.ctrlKey=!1,this.isTracking=!1,this.start=function(e){this.isTracking!==!0&&(e&&(Motif.Ui.Devices.Mouse.x=this.x=e.clientX+Motif.Ui.Devices.Screen.getScrollLeft(),Motif.Ui.Devices.Mouse.y=this.y=e.clientY+Motif.Ui.Devices.Screen.getScrollTop(),Motif.Ui.Devices.Mouse.button=this.button=Motif.BrowserInfo.internetExplorer?Motif.Ui.Devices.Mouse._ieButtons["b"+e.button.toString()]:e.button),this.fireEvent("onbeforestart"),Motif.Ui.Devices.Keyboard.register(this),this.isTracking=!0,this.fireEvent("onstart"))},this.stop=function(){this.isTracking!==!1&&(this.fireEvent("onbeforestop"),Motif.Ui.Devices.Keyboard.unregister(this),this.isTracking=!1,this.fireEvent("onstop"))},this.setKeys=function(e,t,i,o){this.fireEvent("onbeforechange",[this.key,e]),this.lastKey=this.key,this.key=e,this.shiftKey=t,this.ctrlKey=i,this.altKey=o,this.fireEvent("onchange",[this.key])},this.configure=function(e){e=this.Motif$Object.configure(e),Motif.Type.isNumber(e.key)&&(this.key=e.key),Motif.Type.isNumber(e.lastKey)&&(this.lastKey=e.lastKey),Motif.Type.isBoolean(e.shiftKey)&&(this.shiftKey=e.shiftKey),Motif.Type.isBoolean(e.altKey)&&(this.altKey=e.altKey),Motif.Type.isBoolean(e.ctrlKey)&&(this.ctrlKey=e.ctrlKey)},this.toString=function(){return["lastKey="+this.lastKey,"key="+this.key,"shiftKey="+this.shifKey,"altKey="+this.altKey,"ctrlKey="+this.ctrlKey].join(";")+";"},this.onbeforechange=function(e,t){},this.onchange=function(e){},this.main=function(e){e&&this.configure(e)},this.main(e)};