Motif.Page.include("Motif.Ui.Controls.Control.js"),Motif.Page.include("Motif.Ui.Xhtml.EmptyElements.js"),Motif.Page.include("Motif.Dom.Selection.js"),Motif.Page.include("Motif.Dom.Utility.js"),Motif.Ui.Controls.WebBrowser=function(t){Motif.Utility.extend(this,"Motif.Ui.Controls.Control"),this.__class.push("Motif.Ui.Controls.WebBrowser"),this.defaultContent="<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html xmlns='http://www.w3.org/1999/xhtml'><head><title></title><style type='text/css'>body{margin: 0px; padding: 2px;}</style></head><body></body></html>",this.iframe=null,this.window=null,this.document=null,this.isReady=!1,this.isEditable=!1,this._execQueue=[],this._setIframe=function(){return this.isBound()?(Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._setIframe: Adding iframe and setting references."),this.element.appendChild(this.iframe),void this._setWindow()):(Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._setIframe: Element not bound, defering method."),void setTimeout(this.referenceString()+"._setIframe()",100))},this._setWindow=function(){return this.iframe.contentWindow?(this.window=this.iframe.contentWindow,void this._setDocument()):(Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._setWindow: Window not set, defering method."),void setTimeout(this.referenceString()+"._setWindow()",100))},this._setDocument=function(){if(!this.window.document)return Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._setDcoument: Document not set, defering method."),void setTimeout(this.referenceString()+"._setDocument()",100);this.document=this.window.document,this.document.open(),this.document.write(this.defaultContent),this.document.close(),this.isReady=!0,this.fireEvent("onready"),Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._setDocument: Adding user events for iframe window.");for(evt in Motif.Ui.Controls.UserEvents)Motif.Utility.attachEvent(this.window,evt,new Function("window.top."+this.referenceString()+'.fireEvent("'+evt+'");'));Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._setDocument: Executing from _execQueue.");for(var e=0;e<this._execQueue.length;e++){var t=this._execQueue[e];this[t.method]&&(t.parameters||(t.parameters=[]),this[t.method].apply(this,t.parameters))}this._execQueue.length>0&&this._execQueue.splice(0,this._execQueue.length)},this.getSelectedElement=function(){return this.isReady?(Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._getSelectedElement: Getting selection to retreive selected element."),this.getSelection().element):null},this.getSelection=function(){return this.isReady?(Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._getSelecion: Getting selection from window."),new Motif.Dom.Selection(this.window)):null},this.addStylesheet=function(e){if(null==this.document)return void setTimeout(this.referenceString()+".addStylesheet('"+e+"');",200);Motif.Page.log.write("Motif.Ui.Controls.WebBrowser.addStylesheet: Adding stylesheet to document.");var t=this.document.getElementsByTagName("head")[0];if(!t)throw new Error("Motif.Ui.Controls.WebBrowser.addStylesheet: Adding stylesheet failed, HTMLHead not available.");var i=this.document.createElement("link");i.type="text/css",i.href=e,i.rel="stylesheet",t.appendChild(i)},this.addScript=function(e){if(null==this.document)return void setTimeout(this.referenceString()+".addScript('"+e+"');",200);var t=this.document.getElementsByTagName("head")[0];if(!t)throw new Error("Motif.Ui.Controls.WebBrowser.addScript: Adding script failed, HTMLHead not available.");var i=this.document.createElement("script");i.type="text/javascript",i.src=e,t.appendChild(i)},this.enableEdit=function(){this.isReady!==!0&&this._execQueue.push({method:"enableEdit"}),Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._enableEdit: Enabling content edit."),Motif.BrowserInfo.internetExplorer?(this.document.body.disabled=!0,this.document.body.contentEditable=!0,this.document.body.removeAttribute("disabled")):this.document.designMode="on",this.isEditable=Motif.BrowserInfo.internetExplorer?this.document.body.contentEditable:"on"==this.document.designMode,this.isEditable===!1&&(Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._enableEdit: Defer content editable."),new Motif.Delegate(this.enableEdit,[],this,100,!0))},this.disableEdit=function(){this.isReady||this._execQueue.push({method:"disableEdit"}),Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._disableEdit: Disabeling content edit."),Motif.BrowserInfo.internetExplorer?(this.document.body.disabled=!0,this.document.body.contentEditable=!1,this.document.body.removeAttribute("disabled")):this.document.designMode="off",this.isEditable=Motif.BrowserInfo.internetExplorer?this.document.body.contentEditable:"on"==this.document.designMode,this.isEditable===!0&&(Motif.Page.log.write("Motif.Ui.Controls.WebBrowser._disableEdit: Defered disabling content edit."),new Motif.Delegate(this.disableEdit,[],this,100,!0))},this.getXhtml=function(){var e=Motif.Dom.Utility.getXhtml(this.document.body,-1,{body:"div",em:"i",strong:"b"},{contenteditable:"",topmargin:"",rightmargin:"",bottommargin:"",leftmargin:""});return e=e.replace(/^\s+|\s+$/g,""),e=e.substr(5),e=e.substr(0,e.length-6)},this.search=function(e,t){return this.isReady?(this.window.location.href=t+escape(e),void this.onsearch()):void this._execQueue.push({method:"search",parameters:[e,t]})},this.navigate=function(e){return this.isReady?(this.window.location.href=e,void this.fireEvent("onnavigate",[e])):void this._execQueue.push({method:"navigate",parameters:[e]})},this.refresh=function(){return this.isReady?(this.window.location.reload(),void this.fireEvent("onrefresh")):void this._execQueue.push({method:"refresh"})},this.goBack=function(){return this.isReady?(this.window.history.go(-1),void this.fireEvent("ongoback")):void this._execQueue.push({method:"goBack"})},this.goForward=function(){return this.isReady?(this.window.history.go(1),void this.fireEvent("ongoforward")):void this._execQueue.push({method:"goForward"})},this.stop=function(){return this.isReady?(this.document.close(),void this.fireEvent("onstop")):void this._execQueue.push({method:"stop"})},this.configure=function(t){if(t=this.Motif$Ui$Controls$Control.configure(t),t.enableEdit===!0&&this.enableEdit(),t.enableEdit===!1&&this.disableEdit(),t.url&&this.navigate(t.url),t.stylesheet)if("undefined"!=typeof t.stylesheet.pop)for(e in t.stylesheet)this.addStylesheet(t.stylesheet[e]);else this.addStylesheet(t.stylesheet);if(t.script)if("undefined"!=typeof t.script.pop)for(e in t.stylesheet)this.addScript(t.script[e]);else this.addScript(t.script);return t},this.load=function(e){for(Motif.Page.log.write("Motif.Ui.Controls.WebBrowser.load: Loading webbrowser control."),e.innerHTML.length>0&&(this.defaultContent=this.defaultContent.replace("<body></body>","<body>"+e.innerHTML+"</body>"));e.childNodes.length>0;)e.removeChild(e.childNodes[0]);return this.Motif$Ui$Controls$Control.load(e),null},this.setElement=function(e){Motif.Page.log.write("Motif.Ui.Controls.WebBrowser.setElement: Setting the element and adding the iframe to it."),this.Motif$Ui$Controls$Control.setElement(e),this._setIframe()},this.onready=function(){},this.onnavigate=function(){},this.onrefresh=function(){},this.ongoback=function(){},this.ongoforward=function(){},this.onstop=function(){},this.main=function(e){this.iframe=document.createElement("iframe"),this.iframe.style.cssText="width:100%; height:100%; border:none;",this.iframe.border=0,this.iframe.frameBorder="no",Motif.BrowserInfo.internetExplorer&&(this.iframe.src="javascript: void(0);"),e&&this.configure(e)},this.main(t)};