Motif.Page.include("Motif.Ui.Controls.Control.js"),Motif.Page.include("Motif.Ui.Devices.Mouse.js"),Motif.Page.include("Motif.Ui.Utility.js"),Motif.Page.include("Motif.Ui.Css.js"),Motif.Page.include("Motif.Ui.Devices.Keymap.js"),Motif.Ui.Controls.SelectBox=function(t){Motif.Utility.extend(this,"Motif.Ui.Controls.Control"),this.__class.push("Motif.Ui.Controls.SelectBox"),this._trackPosition=!1,this._mouseTracker=new Motif.Ui.Devices.MouseTracker,this._optionPositions=[],this._optionValues=[],this._props={scroll:"scrollLeft",dimension:"w"},this.options=[],this.selected=[],this.type=Motif.Ui.Controls.SelectBoxType.Horizontal,this.scrollAmount=30,this.setValue=function(t){if(!Motif.Type.isArray(t))throw new Error("Motif.Ui.Controls.SelectBox.setValue: Incorrect parameter specified, expected Array.");this.selected.splice(0,this.selected.length);for(var e=0;e<t.length;e++)for(var i=0;i<this._optionValues.length;i++)if(t[e]===this._optionValues[i]){this.select(e);break}},this.getValue=function(){for(var t=[],e=0;e<this.selected.length;e++)this._optionValues[this.selected[e]]&&t.push(this._optionValues[this.selected[e]]);return t},this.getPositionByIndex=function(t){return 0>t&&t<this._optionPositions.length?null:this._optionPositions[t]},this.getValueByIndex=function(t){return 0>t&&t<this._optionPositions.length?"":this._optionValues[t]},this.getIndexByValue=function(t,e){e=0!=e;for(var i=[],s=0;s<this._optionValues.length;s++)(t===this._optionValues[s]||!e&&this._optionValues[s].replace(new RegExp("'"+t+"'","ig"),"").length<this._optionValues[s].length)&&i.push(s);return i},this.setType=function(t){return this.type!==t?(this.type=t,this.refresh(),this):void 0},this.select=function(t){if(0>t||t>this.options.length)throw new Error("Motif.Ui.Controls.SelectBox.select: Index out of range.");if(this.multiselect){var e=this.getSelectedIndex(t);-1==e?(Motif.Ui.Css.addClassName(this.options[t],"Selected"),this.selected.push(t)):(Motif.Ui.Css.removeClassName(this.options[t],"Selected"),this.selected.splice(e,1))}else{if(-1!=this.getSelectedIndex(t))return;for(var i=0;i<this.options.length;i++)Motif.Ui.Css.removeClassName(this.options[i],"Selected");Motif.Ui.Css.addClassName(this.options[t],"Selected"),this.selected.splice(0,this.selected.length),this.selected.push(t)}var s=this.element.scrollLeft;return this.options[t].focus(),this.element.scrollLeft=s,this.fireEvent("onchange",[t]),this},this.getSelectedIndex=function(t){for(var e=0;e<this.selected.length;e++)if(t===this.selected[e])return e;return-1},this.refresh=function(){var t={w:0,h:0};this.element.scrollLeft=this.element.scrollTop=0;for(var e=0,i=this.inner.childNodes.length;i>e;e++){var s=this.inner.childNodes[e];s.tabIndex=this.ptr+e,this.options.push(s),s.onselectstart=function(t){return t=t||event,t.cancelBubble=!0,!1},s.ondragstart=function(t){return t=t||event,t.cancelBubble=!0,!1},s.style.MozUserSelect="none",s.onclick=null,s.onkeypress=null,Motif.Utility.attachEvent(s,"onmouseup",new Function(this.referenceString()+"._itemSelect("+e.toString()+");")),Motif.Utility.attachEvent(s,"onkeypress",new Function("e","e=e||event; if(e.keyCode == Motif.Ui.Devices.Keymap.Space){"+this.referenceString()+"._itemSelect("+e.toString()+");}"));var o=Motif.Ui.Utility.getOuterDimension(s);t.w+=o.w,t.h+=o.h,this._optionPositions.push({x:t.w,y:t.h});var n=s.getAttribute("motifvalue");this._optionValues.push(n||"")}this.type===Motif.Ui.Controls.SelectBoxType.Horizontal&&(Motif.Ui.Css.removeClassName(this.element,"Vertical"),Motif.Ui.Css.addClassName(this.element,"Horizontal"),this.inner.style.width=t.w.toString()+"px",this._props.scroll="scrollLeft",this._props.dimension="w"),this.type===Motif.Ui.Controls.SelectBoxType.Vertical&&(Motif.Ui.Css.removeClassName(this.element,"Horizontal"),Motif.Ui.Css.addClassName(this.element,"Vertical"),this.inner.style.height=t.h.toString()+"px",this._props.scroll="scrollTop",this._props.dimension="h")},this.shiftPrevious=function(){this.shiftBy(-1*this.scrollAmount)},this.shiftNext=function(){this.shiftBy(this.scrollAmount)},this.shift=function(t){if(!Motif.Type.isNumber(t))throw new Error("Motif.Ui.Controls.SelectBox.shift: Invalid parameter specified.");if(t==this.element[this._props.scroll])return!1;var e=Motif.Ui.Utility.getDimension(this.inner),i=Motif.Ui.Utility.getDimension(this.element),s=0,o=e[this._props.dimension]-i[this._props.dimension];return s>t&&(t=s),t>o&&(t=o),t!=this.element[this._props.scroll]?(this.element[this._props.scroll]=t,!0):!1},this.shiftBy=function(t){return this.shift(this.element[this._props.scroll]-t)},this.setElement=function(t){return this.Motif$Ui$Controls$Control.setElement(t),this.element.appendChild(this.inner),this.refresh(),this.attachEvent("onmousedown",this._mouseDown),this.element},this.enableWheel=function(){this.attachEvent("onmousewheel",this._mouseWheel)},this.disableWheel=function(){this.detachEvent("onmousewheel",this._mouseWheel)},this.load=function(t){for(var e=[],i=t.childNodes.length-1;i>=0;i--){var s=t.removeChild(t.childNodes[i]);1===s.nodeType&&e.push(s)}e.reverse(),this.Motif$Ui$Controls$Control.load(t);for(var i=0;i<e.length;i++)this.inner.appendChild(e[i]);this.refresh()},this.configure=function(t){return t=this.Motif$Ui$Controls$Control.configure(t),t.wheel===!0&&this.enableWheel(),t.wheel===!1&&this.disableWheel(),Motif.Type.isNumber(t.scrollAmount)&&(this.scrollAmount=t.scrollAmount),t},this._trackerButtonChange=function(){this._mouseTracker.stop()},this._trackerPositionChange=function(t,e,i,s,o,n){var h=this.type==Motif.Ui.Controls.SelectBoxType.Vertical?n:o;0!==h&&this.shiftBy(h)&&(this._positionChanged=!0)},this._itemSelect=function(t){this._positionChanged!==!0&&this.select(t)},this._mouseDown=function(t){this._positionChanged=!1,this._mouseTracker.start(t.srcEvent)},this._mouseWheel=function(t){t.wheelDelta>0&&this.shiftNext(),t.wheelDelta<0&&this.shiftPrevious(),t.cancel()},this.onchange=function(t){},this.main=function(t){this.inner=document.createElement("div"),this.inner.className="Inner",this._mouseTracker.attachEvent("onbuttonchange",new Function(this.referenceString()+"._trackerButtonChange()")),this._mouseTracker.attachEvent("onpositionchange",new Function("oldx","oldy","newx","newy","diffx","diffy",this.referenceString()+"._trackerPositionChange(oldx, oldy, newx, newy, diffx, diffy)")),t&&this.configure(t)},this.main(t)},Motif.Ui.Controls.SelectBoxType={Horizontal:0,Vertical:1};